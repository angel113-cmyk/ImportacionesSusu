@model Producto

@{
    ViewData["Title"] = "Detalles del Producto";
}

<div class="container-fluid px-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-2 text-gray-800 fw-bold">
                <i class="bi bi-info-circle me-2 text-info"></i>Detalles del Producto
            </h1>
            <p class="text-muted">Información completa del producto en inventario</p>
        </div>
        <a asp-action="Index" class="btn btn-outline-secondary btn-lg">
            <i class="bi bi-arrow-left me-2"></i>Volver a la Lista
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-xl-8 col-lg-10">
            <!-- Tarjeta Principal -->
            <div class="card shadow-lg border-0 rounded-3">
                <div class="card-header bg-info bg-gradient text-white py-4 rounded-top-3">
                    <h5 class="card-title mb-0 fw-semibold text-center">
                        <i class="bi bi-box-seam me-2"></i>Información del Producto
                    </h5>
                </div>
                
                <div class="card-body p-0">
                    <div class="row g-0">
                        <!-- Columna de Imagen -->
                        @if (!string.IsNullOrEmpty(Model.Imagen))
                        {
                            <div class="col-md-4 border-end">
                                <div class="p-4 text-center">
                                    <div class="bg-light rounded-3 p-4 mb-3">
                                        <img src="@Model.Imagen" 
                                             class="img-fluid rounded-2" 
                                             alt="@Model.Nombre"
                                             style="max-height: 200px; object-fit: contain;"
                                             onerror="this.style.display='none'">
                                    </div>
                                    <small class="text-muted">Imagen del producto</small>
                                </div>
                            </div>
                        }
                        
                        <!-- Columna de Información -->
                        <div class="@(!string.IsNullOrEmpty(Model.Imagen) ? "col-md-8" : "col-12")">
                            <div class="p-4">
                                <!-- Información Básica -->
                                <div class="row mb-4">
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label fw-semibold text-muted small mb-1">
                                            <i class="bi bi-tag me-1"></i>Código
                                        </label>
                                        <div class="bg-primary bg-opacity-10 rounded-2 p-3">
                                            <span class="fw-bold text-primary fs-5">@Model.Codigo</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label fw-semibold text-muted small mb-1">
                                            <i class="bi bi-calendar me-1"></i>Fecha de Registro
                                        </label>
                                        <div class="bg-secondary bg-opacity-10 rounded-2 p-3">
                                            <span class="fw-medium text-dark">@Model.FechaRegistro.ToString("dd/MM/yyyy HH:mm")</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Nombre del Producto -->
                                <div class="mb-4">
                                    <label class="form-label fw-semibold text-muted small mb-2">
                                        <i class="bi bi-card-text me-1"></i>Nombre del Producto
                                    </label>
                                    <div class="bg-light rounded-2 p-3 border">
                                        <h4 class="fw-bold text-dark mb-0">@Model.Nombre</h4>
                                    </div>
                                </div>

                                <!-- Información de Precios -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-semibold text-muted small mb-2">
                                            <i class="bi bi-arrow-down-left me-1 text-success"></i>Precio de Compra
                                        </label>
                                        <div class="bg-success bg-opacity-10 rounded-2 p-3 text-center">
                                            <span class="fw-bold text-success fs-4">@Model.PrecioCompra.ToString("C")</span>
                                            <div class="small text-muted mt-1">Costo de importación</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-semibold text-muted small mb-2">
                                            <i class="bi bi-arrow-up-right me-1 text-primary"></i>Precio de Venta
                                        </label>
                                        <div class="bg-primary bg-opacity-10 rounded-2 p-3 text-center">
                                            <span class="fw-bold text-primary fs-4">@Model.PrecioVenta.ToString("C")</span>
                                            <div class="small text-muted mt-1">Precio al público</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cálculos de Rentabilidad -->
                                @{
                                    var ganancia = Model.PrecioVenta - Model.PrecioCompra;
                                    var margen = Model.PrecioCompra > 0 ? (ganancia / Model.PrecioCompra) * 100 : 0;
                                }
                                <div class="row mb-4">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-semibold text-muted small mb-2">
                                            <i class="bi bi-graph-up me-1 text-warning"></i>Ganancia por Unidad
                                        </label>
                                        <div class="bg-warning bg-opacity-10 rounded-2 p-3 text-center">
                                            <span class="fw-bold text-warning fs-4">@ganancia.ToString("C")</span>
                                            <div class="small text-muted mt-1">Por cada unidad vendida</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-semibold text-muted small mb-2">
                                            <i class="bi bi-percent me-1 text-info"></i>Margen de Ganancia
                                        </label>
                                        <div class="bg-info bg-opacity-10 rounded-2 p-3 text-center">
                                            <span class="fw-bold text-info fs-4">@margen.ToString("F1")%</span>
                                            <div class="small text-muted mt-1">Porcentaje de rentabilidad</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Información de Stock -->
                                <div class="row">
                                    <div class="col-12">
                                        <label class="form-label fw-semibold text-muted small mb-2">
                                            <i class="bi bi-boxes me-1"></i>Estado de Inventario
                                        </label>
                                        <div class="rounded-2 p-3 text-center 
                                            @(Model.Stock <= 5 ? "bg-danger bg-opacity-10" : 
                                              Model.Stock <= 15 ? "bg-warning bg-opacity-10" : 
                                              "bg-success bg-opacity-10")">
                                            <div class="row align-items-center">
                                                <div class="col-md-6">
                                                    <span class="fw-bold 
                                                        @(Model.Stock <= 5 ? "text-danger" : 
                                                          Model.Stock <= 15 ? "text-warning" : 
                                                          "text-success") fs-2">
                                                        @Model.Stock
                                                    </span>
                                                    <div class="small text-muted">Unidades en stock</div>
                                                </div>
                                                <div class="col-md-6">
                                                    @if (Model.Stock <= 5)
                                                    {
                                                        <div class="text-danger">
                                                            <i class="bi bi-exclamation-triangle fs-1"></i>
                                                            <div class="small fw-bold mt-1">Stock Crítico</div>
                                                        </div>
                                                    }
                                                    else if (Model.Stock <= 15)
                                                    {
                                                        <div class="text-warning">
                                                            <i class="bi bi-info-circle fs-1"></i>
                                                            <div class="small fw-bold mt-1">Stock Medio</div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="text-success">
                                                            <i class="bi bi-check-circle fs-1"></i>
                                                            <div class="small fw-bold mt-1">Stock Óptimo</div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- URL de Imagen si existe -->
                                @if (!string.IsNullOrEmpty(Model.Imagen))
                                {
                                    <div class="mt-4">
                                        <label class="form-label fw-semibold text-muted small mb-2">
                                            <i class="bi bi-link me-1"></i>Enlace de Imagen
                                        </label>
                                        <div class="bg-light rounded-2 p-3">
                                            <a href="@Model.Imagen" target="_blank" class="text-decoration-none text-truncate d-block">
                                                <i class="bi bi-box-arrow-up-right me-1"></i>@Model.Imagen
                                            </a>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer con Acciones -->
                <div class="card-footer bg-white py-4 border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted">
                                <i class="bi bi-clock-history me-1"></i>
                                ID del producto: <strong>@Model.Id</strong>
                            </small>
                        </div>
                        <div class="d-flex gap-3">
                            <a asp-action="Edit" asp-route-id="@Model.Id" 
                               class="btn btn-warning btn-lg fw-semibold px-4">
                                <i class="bi bi-pencil-square me-2"></i>Editar
                            </a>
                            <a asp-action="Index" 
                               class="btn btn-outline-secondary btn-lg px-4">
                                <i class="bi bi-list-ul me-2"></i>Volver a la Lista
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .card {
            border: none;
            backdrop-filter: blur(10px);
        }
        
        .bg-opacity-10 {
            background-color: rgba(var(--bs-primary-rgb), 0.1) !important;
        }
        
        .border {
            border: 1px solid #dee2e6 !important;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            border: none;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }
        
        .fs-2 {
            font-size: 2rem !important;
        }
        
        .fs-4 {
            font-size: 1.5rem !important;
        }
    </style>
}

@section Scripts {
    <script>
        // Función para mejorar la visualización de imágenes
        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('error', function() {
                    const parent = this.closest('.bg-light');
                    if (parent) {
                        parent.innerHTML = `
                            <div class="text-center text-muted py-4">
                                <i class="bi bi-image fs-1 d-block mb-2"></i>
                                <small>Imagen no disponible</small>
                            </div>
                        `;
                    }
                });
            });
        });
    </script>
},